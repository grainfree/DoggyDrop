@model DoggyDrop.ViewModels.TrashBinViewModel
@{
    ViewData["Title"] = "Dodaj nov koš";
}

<style>
    #map {
        height: 300px;
        width: 100%;
        margin-bottom: 20px;
    }

    .form-container {
        max-width: 600px;
        margin: 0 auto;
    }
</style>

<div class="form-container">
    <h2 class="text-center mb-4">➕ Dodaj nov koš</h2>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success text-center">@TempData["SuccessMessage"]</div>
    }

    <form asp-action="Add" enctype="multipart/form-data" method="post">
        <div class="mb-3">
            <label asp-for="Name" class="form-label">Ime lokacije</label>
            <input asp-for="Name" class="form-control" />
            <span asp-validation-for="Name" class="text-danger small"></span>
        </div>

        <div id="map"></div>

        <input type="hidden" asp-for="Latitude" id="Latitude" />
        <input type="hidden" asp-for="Longitude" id="Longitude" />

        <div class="mb-3">
            <label asp-for="ImageFile" class="form-label">Fotografija koša</label>
            <input asp-for="ImageFile" class="form-control" type="file" accept="image/*" capture="environment" />
            <span asp-validation-for="ImageFile" class="text-danger small"></span>
        </div>

        <button type="submit" class="btn btn-success w-100 rounded-pill">📍 Dodaj koš</button>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        function initMap() {
            const map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 46.5547, lng: 15.6459 },
                zoom: 15
            });

            let marker;

            map.addListener("click", function (e) {
                const lat = e.latLng.lat();
                const lng = e.latLng.lng();

                document.getElementById("Latitude").value = lat;
                document.getElementById("Longitude").value = lng;

                if (marker) marker.setMap(null);

                marker = new google.maps.Marker({
                    position: e.latLng,
                    map: map
                });
            });
        }
    </script>

    <script async
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC7BZuc_0STrDlrpQL6HF3mcQJW2HV4cDI&callback=initMap">
    </script>
}
